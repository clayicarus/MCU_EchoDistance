## 基于 HC-SR04 模块的多路超声波测距系统

使用 C51 实现的多路超声波多通道距离的测量系统，并且依据距离值实现了不同报警等级的功能。

### 实现功能

多通道测距、多通道距离显示（受限于输出外设）、多通道最小距离报警。

### 项目特色

利用单片机剩余性能进行随机数据接收，并在较短的时间延迟内快速处理结果，从而提高了距离测量的精度及效率。

### 使用方法

- 将代码克隆到本地，使用 keil5 打开项目进行编译。
- 将生成结果烧录到指定型号的单片机。
- 根据各个头文件中定义的引脚接线，便可启动系统。

### 使用的芯片模块

STC90C516RD+ 型 51 单片机、HC-SR04 超声波测距模块、LCD_1602 显示屏、LED 指示灯、12 MHz 晶振。

### 系统方案

- 总体方案设计

  - 利用单片机内部的计时器0，以12MHz晶振作为震荡源，采用12T分频模式，对高电平的时间进行测量，从而计算得到一个准确的持续时间。

  - 利用HC-SR04超声波模块进行发射接收，据其返回的高电平持续时间以及超声波的传播速率计算出超声波模块与障碍物的距离，将其作为测距的结果。

  - 根据时分复用的原理，驱动两个或两个以上的超声波模块进行测距，从而达到多路测距的要求。

  - 将测距的结果传入数据处理子程序，对测距的结果进行处理、显示、反馈，从而实现了距离显示、距离警报的功能。

    ![总体方案设计](.\src\overall.png)

- 方案比较选择

  - 超声波测距模块的选择

    根据网络上查找的资料，目前市面上常用的模块有HC-SR04、US-100。

    | 电气参数对比 | HC-SR04   | US-100      |
    | ------------ | --------- | ----------- |
    | 工作电压     | DC 5V     | DC 2.4-5.5V |
    | 静态电流     | <2mA      | 2mA         |
    | 感应角度     | <15°      | <15°        |
    | 探测距离     | 2cm-450cm | 2cm-450cm   |
    | 探测精度     | ±0.2cm    | ±0.3cm      |
    | 数据传输方式 | 电平反馈  | 串口        |
    | 价格         | 3.9元     | 15.07元     |

    由于HC-SR04的功耗性能上与US-100相近，且在精度上要略优于US-100，又考虑到单片机程序对串口通信的要求不高，预算金额差强人意的情况，最终我们小组决定选择HC-SR04作为超声波测距的核心模块。

  - 晶振的选择

    由于采用了HC-SR04芯片，实现超声波的精确测距的关键是准确的计时方式。常见晶振分为12.000MHz和11.0592MHz两种，前者在单片机12T分频模式下的计数周期正好为1微秒；后者则会给串口通信提供便利。而程序不论是在调试上或是输出上都不使用串口通信的方式，故采用12.000MHz的晶振。

  - 输出模块的选择

    考虑到输出模块的价格，我们将LCD1602以及OLED作为首选的输出模块。又因为LCD1602的体积较大，且使用的管脚数目较多，不方便后续拓展。所以即使51单片机在性能上不能够很好地的支持OLED，我们也依旧选择了OLED作为输出模块。

- 方案描述

  单片机整体的程序设计框架如图。

  <img src=".\src\program_structure.png" alt="程序设计框架"  />